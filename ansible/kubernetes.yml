---
- hosts: "all"
  become: true
  gather_facts: false

  tasks:
  - name: "Install Python"
    raw: "apt-get -y -q install python"
  tags:
    - etcd
    - kubernetes

- hosts: "tag_role_node"
  become: true
  gather_facts: true

  tasks:
  - name: "Install Kubernetes APT Key"
    apt_key:
      url: "https://packages.cloud.google.com/apt/doc/apt-key.gpg"
      state: "present"
    tags:
      - kubernetes

  - name: "Add Kubernetes repository for Ubuntu Xenial"
    apt_repository:
      repo: "deb http://apt.kubernetes.io/ kubernetes-xenial main"
      state: "present"
      update_cache: "yes"
    tags:
      - kubernetes

  - name: "Install packages for Docker and Kubernetes"
    apt:
      name: "{{ item }}"
      state: "present"
    with_items:
      - "docker.io"
      - "kubectl"
      - "kubelet"
      - "kubeadm"
    tags:
      - kubernetes
